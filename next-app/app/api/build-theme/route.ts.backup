import { NextRequest, NextResponse } from 'next/server';
import JSZip from 'jszip';

export async function POST(req: NextRequest) {
  try {
    const data = await req.json();
    const zip = new JSZip();
    
    const businessName = data.business_name || data.company || 'Your Business';
    const businessType = data.business_type || data.industry || 'service';
    const location = data.location || data.city || '';
    const phone = data.phone || '';
    const email = data.email || '';
    const primaryColor = data.primary_color || '#2563eb';
    const secondaryColor = data.secondary_color || '#1e40af';
    const accentColor = data.accent_color || '#f59e0b';
    const heroHeadline = data.hero_headline || `Find ${businessType} Near You`;
    const heroSubheadline = data.hero_subheadline || 'Contact Us Now to Get Going!';
    const heroCta = data.hero_cta || 'Rated 5 Stars On Google';
    const aboutDesc = data.about_home_desc || `With over 15 years of experience serving ${location}, we've built a reputation for excellence in ${businessType}. Our commitment to quality materials, exceptional craftsmanship, and outstanding customer service sets us apart.`;

    // Generate reviews
    const reviews = [
      {
        name: 'Sarah Johnson',
        text: `${businessName} transformed our project with their professional service. Highly recommend for any ${businessType} work in ${location}!`,
        date: '2024-08-15'
      },
      {
        name: 'Mike Chen',
        text: `Outstanding work! ${businessName} completed our project on time and within budget. The team was knowledgeable and courteous.`,
        date: '2024-08-10'
      },
      {
        name: 'Lisa Rodriguez',
        text: `We're thrilled with the results. ${businessName} created exactly what we envisioned and more. Their expertise is unmatched.`,
        date: '2024-08-05'
      }
    ];

    // Generate services
    const services = (data.services || []).map((s: any) => ({
      name: s.name || '',
      description: s.description || `Professional ${s.name} services with attention to detail and quality results.`
    }));

    // Generate locations
    const locations = (data.service_areas || data.locations || []).map((l: any) => ({
      name: l.name || '',
      state: l.state || data.state || ''
    }));

    // Style.css - Based on Plugin Template
    const styleCss = `/*
Theme Name: ${businessName} - Professional ${businessType}
Description: Custom professional ${businessType} website with embedded content
Version: 1.0
Author: Generated by Create A Website Click
*/

:root {
    --dark-navy: #1C232B;
    --medium-navy: #2A3440;
    --light-gray: #E2E8F0;
    --teal: #38B2AC;
    --white: #FFFFFF;
    --text-gray: #A0AEC0;
    --border-color: #4A5568;
    --nav-bg: var(--surface-color);
    --primary-color: ${primaryColor};
    --secondary-color: ${secondaryColor};
    --accent-color: ${accentColor};
    --surface-color: #0f172a;
    --text-color: #e5e7eb;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--dark-navy);
    color: var(--white);
    font-size: 16px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.main-header {
    background-color: var(--nav-bg);
    border-bottom: 1px solid var(--border-color);
    min-height: 80px;
    padding: 0;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.main-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 80px;
    padding: 0 40px;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: var(--text-color);
    font-weight: 700;
    font-size: 1.5rem;
}

.logo img,
.logo svg {
    width: 40px;
    height: 30px;
}

.main-nav {
    display: flex;
    align-items: center;
}

.nav-menu {
    display: flex;
    list-style: none;
    gap: 2rem;
    margin: 0;
}

.nav-menu a {
    color: var(--text-color);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
    padding: 0.5rem 1rem;
    border-radius: 6px;
}

.nav-menu a:hover {
    color: var(--primary-color);
    background: rgba(255, 255, 255, 0.1);
}

.has-dropdown {
    position: relative;
}

.dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem 0;
    min-width: 200px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    list-style: none;
}

.has-dropdown:hover .dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown li {
    margin: 0;
}

.dropdown a {
    display: block;
    padding: 0.5rem 1.5rem;
    color: var(--text-color);
    text-decoration: none;
    transition: background 0.3s ease;
}

.dropdown a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--primary-color);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

.btn-teal {
    background: var(--primary-color);
    color: #ffffff;
}

.btn-teal:hover {
    background: #1d4ed8;
    transform: translateY(-2px);
}

.btn-dark {
    background: var(--secondary-color);
    color: #00131a;
}

.btn-dark:hover {
    background: #0ea5e9;
    transform: translateY(-2px);
}

.hamburger {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 4px;
}

.hamburger span {
    width: 25px;
    height: 3px;
    background: var(--text-color);
    transition: 0.3s;
}

/* Hero Section */
.hero-section {
    background-color: var(--surface-color);
    color: var(--text-color);
    padding: 120px 0 80px;
    position: relative;
    overflow: hidden;
}

.hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    opacity: 0.9;
}

.hero-content {
    position: relative;
    z-index: 2;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
}

.hero-text {
    max-width: 600px;
}

.subtitle {
    color: var(--accent-color);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 1rem;
    font-weight: 600;
}

.hero-content h1 {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    line-height: 1.1;
    color: var(--white);
}

.hero-content p {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.6;
}

.hero-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.google-rating {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stars {
    display: flex;
    gap: 0.25rem;
}

.stars svg {
    width: 20px;
    height: 20px;
}

.rating-text {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}

/* Contact Form */
.contact-form {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 2.5rem;
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.form-title {
    color: var(--dark-navy);
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    font-weight: 700;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    color: var(--dark-navy);
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: white;
    color: var(--dark-navy);
    font-size: 1rem;
    transition: all 0.3s ease;
    font-family: inherit;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
    color: var(--text-gray);
}

.form-group textarea {
    min-height: 120px;
    resize: vertical;
}

.btn-submit {
    background: var(--primary-color);
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    width: 100%;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.btn-submit:hover {
    background: #1d4ed8;
    transform: translateY(-2px);
}

/* Section Styles */
.section {
    padding: 80px 0;
}

.section-header {
    text-align: center;
    margin-bottom: 4rem;
}

.section-label {
    color: var(--primary-color);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.section-title {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--white);
}

.section-subtitle {
    color: var(--text-gray);
    font-size: 1.2rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.7;
}

/* Features Section */
.features-section {
    background-color: var(--medium-navy);
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2.5rem;
}

.feature-card {
    text-align: center;
    padding: 3rem 2rem;
    border-radius: 16px;
    background: var(--dark-navy);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.feature-icon {
    font-size: 3rem;
    margin-bottom: 1.5rem;
    color: var(--primary-color);
}

.feature-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--white);
}

.feature-description {
    color: var(--text-gray);
    line-height: 1.7;
    font-size: 1.1rem;
}

/* About Section */
.about-section {
    background-color: var(--dark-navy);
}

.about-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
}

.about-image {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    height: 400px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: white;
    position: relative;
    overflow: hidden;
}

.about-text .section-label {
    color: var(--primary-color);
}

.about-text .section-title {
    color: var(--white);
    margin-bottom: 1.5rem;
    font-size: 2.5rem;
}

.about-text p {
    color: var(--text-gray);
    margin-bottom: 2rem;
    line-height: 1.8;
    font-size: 1.1rem;
}

.about-badge {
    background: var(--primary-color);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    display: inline-block;
    margin-bottom: 2rem;
    font-weight: 600;
    font-size: 0.875rem;
}

/* Services Section */
.services-section {
    background-color: var(--medium-navy);
}

.services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2.5rem;
}

.service-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 2.5rem;
    border-radius: 16px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.service-card:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-5px);
}

.service-icon {
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
    color: var(--primary-color);
}

.service-card h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--white);
}

.service-card p {
    color: var(--text-gray);
    margin-bottom: 1.5rem;
    line-height: 1.7;
    font-size: 1.1rem;
}

.service-phone {
    color: var(--primary-color);
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 1.1rem;
}

.service-link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
    transition: color 0.3s ease;
}

.service-link:hover {
    color: #1d4ed8;
}

/* Reviews Section */
.reviews-section {
    background-color: var(--dark-navy);
}

.reviews-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2.5rem;
}

.review-card {
    background: var(--medium-navy);
    padding: 2.5rem;
    border-radius: 16px;
    border-left: 4px solid var(--primary-color);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.review-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.reviewer-name {
    font-weight: 600;
    color: var(--white);
    font-size: 1.1rem;
}

.review-date {
    color: var(--text-gray);
    font-size: 0.9rem;
}

.review-stars {
    color: #fbbf24;
    margin-bottom: 1rem;
    font-size: 1.2rem;
}

.review-text {
    color: var(--text-gray);
    line-height: 1.7;
    font-size: 1.1rem;
}

/* Footer */
.site-footer {
    background-color: var(--surface-color);
    color: var(--text-color);
    padding: 60px 0 40px;
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 3rem;
    margin-bottom: 3rem;
}

.footer-section h3 {
    margin-bottom: 1.5rem;
    color: var(--primary-color);
    font-size: 1.2rem;
    font-weight: 600;
}

.footer-section p,
.footer-section a {
    color: var(--text-gray);
    text-decoration: none;
    line-height: 1.7;
    margin-bottom: 0.5rem;
    transition: color 0.3s ease;
}

.footer-section a:hover {
    color: var(--primary-color);
}

.footer-bottom {
    border-top: 1px solid var(--border-color);
    padding-top: 2rem;
    color: var(--text-gray);
    text-align: center;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .main-header .container {
        padding: 0 1rem;
    }
    
    .main-nav {
        position: fixed;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100vh;
        background: var(--surface-color);
        backdrop-filter: blur(10px);
        transition: left 0.3s ease;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .main-nav.open {
        left: 0;
    }
    
    .nav-menu {
        flex-direction: column;
        gap: 2rem;
        text-align: center;
    }
    
    .nav-menu li {
        margin: 0;
    }
    
    .nav-menu a {
        font-size: 1.5rem;
        padding: 1rem;
        display: block;
    }
    
    .dropdown {
        position: static;
        background: none;
        box-shadow: none;
        padding: 0;
        margin-top: 1rem;
    }
    
    .dropdown li {
        margin: 0.5rem 0;
    }
    
    .dropdown a {
        font-size: 1.2rem;
        padding: 0.5rem;
    }
    
    .hamburger {
        display: block;
        cursor: pointer;
        z-index: 1001;
    }
    
    .hamburger.active span:nth-child(1) {
        transform: rotate(-45deg) translate(-5px, 6px);
    }
    
    .hamburger.active span:nth-child(2) {
        opacity: 0;
    }
    
    .hamburger.active span:nth-child(3) {
        transform: rotate(45deg) translate(-5px, -6px);
    }
    
    .hero-content {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .hero-content h1 {
        font-size: 2.5rem;
    }
    
    .section-title {
        font-size: 2.5rem;
    }
    
    .features-grid,
    .services-grid,
    .reviews-grid {
        grid-template-columns: 1fr;
    }
    
    .hero-actions {
        flex-direction: column;
    }
    
    .about-content {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .contact-form {
        padding: 2rem;
    }
}`;

    // Index.php - Based on Plugin Template
    const indexPhp = `<?php
/*
 * Template Name: BSG Dynamic Homepage
 * Description: Dynamic homepage that uses admin panel settings
 */

// Get settings from admin panel
$settings = get_option('bsg_settings', []);

$business_name = '${businessName}';
$tagline = 'Professional ${businessType} Services You Can Trust';
$phone = '${phone}';
$email = '${email}';
$address = '${data.address || '123 Main Street, City, State 12345'}';

// Hero section settings
$hero_visible = 1;
$hero_headline = '${heroHeadline}';
$hero_subheadline = '${heroSubheadline}';
$hero_cta = '${heroCta}';

// Features section settings
$features_visible = 1;
$features = [
    ['title' => 'Thorough Site Inspection', 'description' => 'We start every project with a comprehensive assessment to understand your specific needs and provide the best solution.', 'icon' => '✓'],
    ['title' => 'Premium Quality Materials', 'description' => 'We use only the highest quality materials and equipment to ensure lasting results and customer satisfaction.', 'icon' => '🌿'],
    ['title' => 'Expert Craftsmanship', 'description' => 'Our team of skilled professionals brings years of experience and attention to detail to every project.', 'icon' => '👷']
];

// Services section settings
$services_visible = 1;
$services_title = 'Our Services';
$services_label = 'TOP RATED ${businessType.toUpperCase()}';
$services = array(
    ${services.map((service: any) => `array('name' => '${service.name.replace(/'/g, "\\'")}', 'description' => '${service.description.replace(/'/g, "\\'")}')`).join(',\n    ')}
);

// About section settings
$about_visible = 1;
$about_tagline = 'WHO WE ARE';
$about_headline = 'About ${businessName}';
$about_desc = '${aboutDesc}';

// Reviews section settings
$reviews_visible = 1;
$reviews_title = 'What Our Customers Say';
$reviews = array(
    ${reviews.map((review: any) => `array('name' => '${review.name.replace(/'/g, "\\'")}', 'text' => '${review.text.replace(/'/g, "\\'")}', 'date' => '${review.date}')`).join(',\n    ')}
);

// Design colors
$primary_color = '${primaryColor}';
$secondary_color = '${secondaryColor}';
$accent_color = '${accentColor}';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo esc_html($business_name . ' - ' . $tagline); ?></title>
    <meta name="description" content="<?php echo esc_attr($business_name . ' provides professional ' . strtolower('${businessType}') . ' services in ${location}. Get free estimates, expert installation, and reliable service. Call ' . $phone . ' today!'); ?>">
    <meta name="keywords" content="<?php echo esc_attr(strtolower('${businessType}') . ' services, repair, installation, contractor, ' . strtolower($business_name)); ?>">
    <meta name="author" content="<?php echo esc_attr($business_name); ?>">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="<?php echo esc_url(home_url('/')); ?>">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="<?php echo esc_attr($business_name . ' - ' . $tagline); ?>">
    <meta property="og:description" content="<?php echo esc_attr($business_name . ' provides professional ' . strtolower('${businessType}') . ' services in ${location}. Get free estimates, expert installation, and reliable service.'); ?>">
    <meta property="og:type" content="website">
    <meta property="og:url" content="<?php echo esc_url(home_url('/')); ?>">
    <meta property="og:site_name" content="<?php echo esc_attr($business_name); ?>">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<?php echo esc_attr($business_name . ' - ' . $tagline); ?>">
    <meta name="twitter:description" content="<?php echo esc_attr($business_name . ' provides professional ' . strtolower('${businessType}') . ' services in ${location}. Get free estimates, expert installation, and reliable service.'); ?>">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "<?php echo esc_js($business_name); ?>",
        "description": "<?php echo esc_js($business_name . ' provides professional ' . strtolower('${businessType}') . ' services in ${location}'); ?>",
        "url": "<?php echo esc_url(home_url('/')); ?>",
        "telephone": "<?php echo esc_js($phone); ?>",
        "email": "<?php echo esc_js($email); ?>",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "<?php echo esc_js($address); ?>"
        },
        "serviceArea": {
            "@type": "GeoCircle",
            "geoRadius": "50000",
            "geoMidpoint": {
                "@type": "GeoCoordinates",
                "latitude": "",
                "longitude": ""
            }
        },
        "openingHours": "Mo-Fr 08:00-17:00",
        "priceRange": "$$",
        "areaServed": "${location}"
    }
    </script>
    
    <link rel="stylesheet" href="<?php echo get_stylesheet_uri(); ?>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: <?php echo esc_attr($primary_color); ?>;
            --secondary-color: <?php echo esc_attr($secondary_color); ?>;
            --accent-color: <?php echo esc_attr($accent_color); ?>;
            --surface-color: #0f172a;
            --text-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="container">
            <a href="<?php echo home_url('/'); ?>" class="logo">
                <svg width="40" height="30" viewBox="0 0 40 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 0L0 20H10L20 10L30 20H40L20 0Z" fill="<?php echo esc_attr($primary_color); ?>"/>
                    <path d="M10 20L20 30L30 20H10Z" fill="<?php echo esc_attr($secondary_color); ?>"/>
                </svg>
                <span><?php echo wp_kses_post(html_entity_decode($business_name)); ?></span>
            </a>
            <div class="hamburger" id="hamburger-menu" aria-label="Open menu" tabindex="0">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <nav class="main-nav" id="main-nav">
                <ul class="nav-menu">
                    <li><a href="<?php echo home_url('/'); ?>">Home</a></li>
                    <li class="has-dropdown">
                        <a href="#" class="dropdown-toggle" onclick="return false;" aria-haspopup="true" aria-expanded="false">Services <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg></a>
                        <ul class="dropdown">
                            <?php 
                            $services = array(
                                ${services.map((service: any) => `array('name' => '${service.name}', 'description' => '${service.description}')`).join(',\n                                ')}
                            );
                            foreach ($services as $service): ?>
                                <?php if (!empty($service['name'])): ?>
                                    <li><a href="<?php echo home_url('/services/'); ?>"><?php echo esc_html($service['name']); ?></a></li>
                                <?php endif; ?>
                            <?php endforeach; ?>
                        </ul>
                    </li>
                    <li><a href="<?php echo home_url('/about-us/'); ?>">About</a></li>
                    <li><a href="<?php echo home_url('/contact-us/'); ?>">Contact Us</a></li>
                    <li><a href="<?php echo home_url('/service-areas/'); ?>">Service Areas</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-teal">
                    <i class="fa-solid fa-phone"></i> <?php echo esc_html($phone); ?>
                </a>
            </div>
        </div>
    </header>

    <main>
        <?php if ($hero_visible): ?>
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <p class="subtitle">
                            <?php echo esc_html(strtoupper($business_name)); ?>
                        </p>
                        <h1>
                            <?php echo esc_html($hero_headline); ?>
                        </h1>
                        <p>
                            <?php echo esc_html($hero_subheadline); ?>
                        </p>
                        <p class="hero-description">
                            Professional ${businessType} services with years of experience. We provide top-quality work and exceptional customer service to ${location}.
                        </p>
                        <div class="hero-actions">
                            <a href="#contact" class="btn btn-teal">Get Free Quote</a>
                            <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-dark">Call <?php echo esc_html($phone); ?></a>
                        </div>
                        <div class="google-rating">
                            <div class="stars">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                            </div>
                            <div class="rating-text"><?php echo esc_html($hero_cta); ?></div>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3 class="form-title">Get Your Free Quote</h3>
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" placeholder="Your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="Your email address" required>
                            </div>
                            <div class="form-group">
                                <label for="message">How Can We Help You?</label>
                                <textarea id="message" name="message" placeholder="Describe your ${businessType} needs" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <?php endif; ?>

        <?php if ($features_visible): ?>
        <section class="features-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">WHAT YOU GET</div>
                    <h2 class="section-title">Why Choose Us</h2>
                    <p class="section-subtitle">We deliver exceptional results with every project, ensuring your complete satisfaction.</p>
                </div>
                <div class="features-grid">
                    <?php foreach ($features as $feature): ?>
                    <div class="feature-card">
                        <div class="feature-icon"><?php echo esc_html($feature['icon']); ?></div>
                        <h3 class="feature-title"><?php echo esc_html($feature['title']); ?></h3>
                        <p class="feature-description"><?php echo esc_html($feature['description']); ?></p>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </section>
        <?php endif; ?>

        <?php if ($about_visible): ?>
        <section class="about-section section">
            <div class="container">
                <div class="about-content">
                    <div class="about-image">
                        Professional Team
                    </div>
                    <div class="about-text">
                        <div class="section-label"><?php echo esc_html($about_tagline); ?></div>
                        <h2 class="section-title"><?php echo esc_html($about_headline); ?></h2>
                        <p><?php echo esc_html($about_desc); ?></p>
                        <div class="about-badge">15 Years of Experience</div>
                        <a href="#about" class="btn btn-teal">About Us</a>
                    </div>
                </div>
            </div>
        </section>
        <?php endif; ?>

        <?php if ($services_visible): ?>
        <section class="services-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label"><?php echo esc_html($services_label); ?></div>
                    <h2 class="section-title"><?php echo esc_html($services_title); ?></h2>
                </div>
                <div class="services-grid">
                    <?php 
                    $services = array(
                        ${services.map((service: any) => `array('name' => '${service.name}', 'description' => '${service.description}')`).join(',\n                        ')}
                    );
                    foreach ($services as $service): ?>
                        <?php if (!empty($service['name'])): ?>
                        <div class="service-card">
                            <div class="service-icon">✓</div>
                            <h3><?php echo esc_html($service['name']); ?></h3>
                            <p><?php echo esc_html($service['description']); ?></p>
                            <div class="service-phone"><?php echo esc_html($phone); ?></div>
                            <a href="<?php echo home_url('/services/'); ?>" class="service-link">See More →</a>
                        </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            </div>
        </section>
        <?php endif; ?>

        <?php if ($reviews_visible): ?>
        <section class="reviews-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">TESTIMONIALS</div>
                    <h2 class="section-title"><?php echo esc_html($reviews_title); ?></h2>
                </div>
                <div class="reviews-grid">
                    <?php foreach ($reviews as $review): ?>
                        <?php if (!empty($review['name']) && !empty($review['text'])): ?>
                        <div class="review-card">
                            <div class="review-header">
                                <div class="reviewer-name"><?php echo esc_html($review['name']); ?></div>
                                <div class="review-date"><?php echo esc_html($review['date']); ?></div>
                            </div>
                            <div class="review-stars">★★★★★</div>
                            <p class="review-text"><?php echo esc_html($review['text']); ?></p>
                        </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            </div>
        </section>
        <?php endif; ?>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><?php echo esc_html($business_name); ?></h3>
                    <p>Professional ${businessType} services in ${location}</p>
                    <p>Phone: <?php echo esc_html($phone); ?></p>
                    <p>Email: <?php echo esc_html($email); ?></p>
                </div>
                <div class="footer-section">
                    <h3>Our Services</h3>
                    <?php foreach ($services as $service): ?>
                        <?php if (!empty($service['name'])): ?>
                            <p><?php echo esc_html($service['name']); ?></p>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
                <div class="footer-section">
                    <h3>Service Areas</h3>
                    <p>${location}</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> <?php echo esc_html($business_name); ?>. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.getElementById('hamburger-menu').addEventListener('click', function() {
            this.classList.toggle('active');
            document.getElementById('main-nav').classList.toggle('open');
        });
    </script>
</body>
</html>`;

    // Header.php - Based on Plugin Template
    const headerPhp = `<!DOCTYPE html>
<html <?php language_attributes(); ?>>
<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php wp_title('|', true, 'right'); ?></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <?php wp_head(); ?>
</head>
<body <?php body_class(); ?>>
    <header class="main-header">
        <div class="container">
            <a href="<?php echo home_url('/'); ?>" class="logo">
                <svg width="40" height="30" viewBox="0 0 40 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 0L0 20H10L20 10L30 20H40L20 0Z" fill="<?php echo esc_attr(get_option('bsg_primary_color', '#2563eb')); ?>"/>
                    <path d="M10 20L20 30L30 20H10Z" fill="<?php echo esc_attr(get_option('bsg_secondary_color', '#1e40af')); ?>"/>
                </svg>
                <span><?php echo wp_kses_post(html_entity_decode(get_option('bsg_business_name', 'Your Business'))); ?></span>
            </a>
            <div class="hamburger" id="hamburger-menu" aria-label="Open menu" tabindex="0">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <nav class="main-nav" id="main-nav">
                <ul class="nav-menu">
                    <li><a href="<?php echo home_url('/'); ?>">Home</a></li>
                    <li class="has-dropdown">
                        <a href="#" class="dropdown-toggle" onclick="return false;" aria-haspopup="true" aria-expanded="false">Services <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg></a>
                        <ul class="dropdown">
                            <?php
                            $services = array(
                                ${services.map((service: any) => `array('name' => '${service.name}', 'description' => '${service.description}')`).join(',\n                                ')}
                            );
                            foreach ($services as $service) {
                                if (!empty($service['name'])) {
                                    echo '<li><a href="' . home_url('/services/') . '">' . esc_html($service['name']) . '</a></li>';
                                }
                            }
                            ?>
                        </ul>
                    </li>
                    <li><a href="<?php echo home_url('/about-us/'); ?>">About</a></li>
                    <li><a href="<?php echo home_url('/contact-us/'); ?>">Contact Us</a></li>
                    <li><a href="<?php echo home_url('/service-areas/'); ?>">Service Areas</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <a href="tel:<?php echo esc_attr(get_option('bsg_phone', '(555) 123-4567')); ?>" class="btn btn-teal">
                    <i class="fa-solid fa-phone"></i> <?php echo esc_html(get_option('bsg_phone', '(555) 123-4567')); ?>
                </a>
            </div>
        </div>
    </header>
    <main id="main" class="site-main">`;

    // Footer.php - Based on Plugin Template
    const footerPhp = `
    </main>
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><?php echo esc_html(get_option('bsg_business_name', 'Your Business')); ?></h3>
                    <p>Professional services in your area</p>
                    <p>Phone: <?php echo esc_html(get_option('bsg_phone', '(555) 123-4567')); ?></p>
                    <p>Email: <?php echo esc_html(get_option('bsg_email', 'info@yourbusiness.com')); ?></p>
                </div>
                <div class="footer-section">
                    <h3>Our Services</h3>
                    <?php
                    $services = array(
                        ${services.map((service: any) => `array('name' => '${service.name}', 'description' => '${service.description}')`).join(',\n                        ')}
                    );
                    foreach ($services as $service) {
                        if (!empty($service['name'])) {
                            echo '<p>' . esc_html($service['name']) . '</p>';
                        }
                    }
                    ?>
                </div>
                <div class="footer-section">
                    <h3>Service Areas</h3>
                    <p><?php echo esc_html(get_option('bsg_location', 'Your Area')); ?></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <?php echo date('Y'); ?> <?php echo esc_html(get_option('bsg_business_name', 'Your Business')); ?>. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Mobile menu toggle
        document.getElementById('hamburger-menu').addEventListener('click', function() {
            this.classList.toggle('active');
            document.getElementById('main-nav').classList.toggle('open');
        });
    </script>
    <?php wp_footer(); ?>
</body>
</html>`;

    // Functions.php
    const functionsPhp = `<?php
if (!defined('ABSPATH')) exit;

function ${businessName.toLowerCase().replace(/\s+/g, '_')}_enqueue_styles() {
    wp_enqueue_style('${businessName.toLowerCase().replace(/\s+/g, '-')}-style', get_stylesheet_uri());
}
add_action('wp_enqueue_scripts', '${businessName.toLowerCase().replace(/\s+/g, '_')}_enqueue_styles');

function ${businessName.toLowerCase().replace(/\s+/g, '_')}_setup() {
    add_theme_support('title-tag');
    add_theme_support('post-thumbnails');
    add_theme_support('custom-logo');
    add_theme_support('html5', array(
        'search-form',
        'comment-form',
        'comment-list',
        'gallery',
        'caption',
    ));
}
add_action('after_setup_theme', '${businessName.toLowerCase().replace(/\s+/g, '_')}_setup');
?>`;
    
    // Service Template
    const servicePhp = `<?php
/*
 * Template Name: BSG Service
 * Description: Dynamic service page template
 */

// Get settings from admin panel
$settings = get_option('bsg_settings', []);

$business_name = '${businessName}';
$phone = '${phone}';
$email = '${email}';
$address = '${data.address || '123 Main Street, City, State 12345'}';

// Design colors
$primary_color = '${primaryColor}';
$secondary_color = '${secondaryColor}';
$accent_color = '${accentColor}';

// Get current service data
$current_service = array('name' => 'Professional Services', 'description' => 'Comprehensive solutions for all your needs');

// Default service features
$service_features = [
    'Personalized consultations to assess your specific needs',
    'Premium material selection and recommendations',
    'Professional installation with attention to detail',
    'Comprehensive warranty coverage',
    'Emergency repair and maintenance services',
    'Free estimates and competitive pricing'
];
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo esc_html($business_name . ' - ' . ($current_service['name'] ?? 'Services')); ?></title>
    <meta name="description" content="<?php echo esc_attr($business_name . ' provides professional ' . ($current_service['name'] ?? 'services') . ' in ${location}. Get free estimates and expert service.'); ?>">
    <link rel="stylesheet" href="<?php echo get_stylesheet_uri(); ?>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: <?php echo esc_attr($primary_color); ?>;
            --secondary-color: <?php echo esc_attr($secondary_color); ?>;
            --accent-color: <?php echo esc_attr($accent_color); ?>;
            --surface-color: #0f172a;
            --text-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <?php include get_template_directory() . '/header.php'; ?>

    <main>
        <!-- Service Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <p class="subtitle"><?php echo esc_html(strtoupper($business_name)); ?></p>
                        <h1><?php echo esc_html($current_service['name'] ?? 'Our Services'); ?></h1>
                        <p><?php echo esc_html($current_service['description'] ?? 'Professional services you can count on'); ?></p>
                        <div class="hero-actions">
                            <a href="#contact" class="btn btn-teal">Get Free Quote</a>
                            <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-dark">Call <?php echo esc_html($phone); ?></a>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3 class="form-title">Get Your Free Quote</h3>
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" placeholder="Your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="Your email address" required>
                            </div>
                            <div class="form-group">
                                <label for="message">How Can We Help You?</label>
                                <textarea id="message" name="message" placeholder="Describe your needs" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Features Section -->
        <section class="features-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">WHAT WE OFFER</div>
                    <h2 class="section-title">Service Features</h2>
                    <p class="section-subtitle">Comprehensive solutions tailored to your needs</p>
                </div>
                <div class="features-grid">
                    <?php foreach ($service_features as $feature): ?>
                    <div class="feature-card">
                        <div class="feature-icon">✓</div>
                        <h3 class="feature-title"><?php echo esc_html($feature); ?></h3>
                        <p class="feature-description">Professional service with attention to detail and quality results.</p>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="about-section section">
            <div class="container">
                <div class="about-content">
                    <div class="about-image">
                        Professional Team
                    </div>
                    <div class="about-text">
                        <div class="section-label">WHO WE ARE</div>
                        <h2 class="section-title">About <?php echo esc_html($business_name); ?></h2>
                        <p>${aboutDesc}</p>
                        <div class="about-badge">15 Years of Experience</div>
                        <a href="#about" class="btn btn-teal">About Us</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <?php include get_template_directory() . '/footer.php'; ?>
</body>
</html>`;

    // About Template
    const aboutPhp = `<?php
/*
 * Template Name: BSG About
 * Description: About page for your business
 */

// Get settings from admin panel
$settings = get_option('bsg_settings', []);

$business_name = '${businessName}';
$phone = '${phone}';
$email = '${email}';
$address = '${data.address || '123 Main Street, City, State 12345'}';

// Design colors
$primary_color = '${primaryColor}';
$secondary_color = '${secondaryColor}';
$accent_color = '${accentColor}';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo esc_html($business_name . ' - About Us'); ?></title>
    <meta name="description" content="<?php echo esc_attr('Learn about ' . $business_name . ', a trusted contractor with years of experience. Professional services, quality workmanship, and customer satisfaction.'); ?>">
    <link rel="stylesheet" href="<?php echo get_stylesheet_uri(); ?>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: <?php echo esc_attr($primary_color); ?>;
            --secondary-color: <?php echo esc_attr($secondary_color); ?>;
            --accent-color: <?php echo esc_attr($accent_color); ?>;
            --surface-color: #0f172a;
            --text-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <?php include get_template_directory() . '/header.php'; ?>

    <main>
        <!-- About Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <p class="subtitle">ABOUT <?php echo esc_html(strtoupper($business_name)); ?></p>
                        <h1>Professional Services You Can Count On</h1>
                        <p>Years of experience serving our community with quality and dedication</p>
                        <div class="hero-actions">
                            <a href="#contact" class="btn btn-teal">Get Free Quote</a>
                            <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-dark">Call <?php echo esc_html($phone); ?></a>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3 class="form-title">Get Your Free Quote</h3>
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" placeholder="Your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="Your email address" required>
                            </div>
                            <div class="form-group">
                                <label for="message">How Can We Help You?</label>
                                <textarea id="message" name="message" placeholder="Describe your needs" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Content Section -->
        <section class="about-section section">
            <div class="container">
                <div class="about-content">
                    <div class="about-image">
                        Professional Team
                    </div>
                    <div class="about-text">
                        <div class="section-label">WHO WE ARE</div>
                        <h2 class="section-title">About <?php echo esc_html($business_name); ?></h2>
                        <p>${aboutDesc}</p>
                        <div class="about-badge">15 Years of Experience</div>
                        <a href="#contact" class="btn btn-teal">Contact Us</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section class="services-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">OUR SERVICES</div>
                    <h2 class="section-title">What We Offer</h2>
                </div>
                <div class="services-grid">
                    <?php
                    $services = ${JSON.stringify(services)};
                    foreach ($services as $service):
                        if (!empty($service['name'])):
                    ?>
                    <div class="service-card">
                        <div class="service-icon">✓</div>
                        <h3><?php echo esc_html($service['name']); ?></h3>
                        <p><?php echo esc_html($service['description']); ?></p>
                        <div class="service-phone"><?php echo esc_html($phone); ?></div>
                        <a href="#services" class="service-link">See More →</a>
                    </div>
                    <?php 
                        endif;
                    endforeach; 
                    ?>
                </div>
            </div>
        </section>

        <!-- Reviews Section -->
        <section class="reviews-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">TESTIMONIALS</div>
                    <h2 class="section-title">What Our Customers Say</h2>
                </div>
                <div class="reviews-grid">
                    <?php
                    $reviews = array(
                        ${reviews.map((review: any) => `array('name' => '${review.name}', 'text' => '${review.text}', 'date' => '${review.date}')`).join(',\n                        ')}
                    );
                    foreach ($reviews as $review):
                        if (!empty($review['name']) && !empty($review['text'])):
                    ?>
                    <div class="review-card">
                        <div class="review-header">
                            <div class="reviewer-name"><?php echo esc_html($review['name']); ?></div>
                            <div class="review-date"><?php echo esc_html($review['date']); ?></div>
                        </div>
                        <div class="review-stars">★★★★★</div>
                        <p class="review-text"><?php echo esc_html($review['text']); ?></p>
                    </div>
                    <?php 
                        endif;
                    endforeach; 
                    ?>
                </div>
            </div>
        </section>
    </main>

    <?php include get_template_directory() . '/footer.php'; ?>
</body>
</html>`;

    // Contact Template
    const contactPhp = `<?php
/*
 * Template Name: BSG Contact
 * Description: Contact page for your business
 */

// Get settings from admin panel
$settings = get_option('bsg_settings', []);

$business_name = '${businessName}';
$phone = '${phone}';
$email = '${email}';
$address = '${data.address || '123 Main Street, City, State 12345'}';

// Design colors
$primary_color = '${primaryColor}';
$secondary_color = '${secondaryColor}';
$accent_color = '${accentColor}';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo esc_html($business_name . ' - Contact Us'); ?></title>
    <meta name="description" content="<?php echo esc_attr('Contact ' . $business_name . ' for professional services. Get free estimates, expert consultation, and reliable service.'); ?>">
    <link rel="stylesheet" href="<?php echo get_stylesheet_uri(); ?>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: <?php echo esc_attr($primary_color); ?>;
            --secondary-color: <?php echo esc_attr($secondary_color); ?>;
            --accent-color: <?php echo esc_attr($accent_color); ?>;
            --surface-color: #0f172a;
            --text-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <?php include get_template_directory() . '/header.php'; ?>

    <main>
        <!-- Contact Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <p class="subtitle">CONTACT US</p>
                        <h1>Get Your Free Estimate</h1>
                        <p>Contact us today for professional services and expert consultation</p>
                        <div class="hero-actions">
                            <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-teal">Call <?php echo esc_html($phone); ?></a>
                            <a href="mailto:<?php echo esc_attr($email); ?>" class="btn btn-dark">Email Us</a>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3 class="form-title">Get Your Free Quote</h3>
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" placeholder="Your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="Your email address" required>
                            </div>
                            <div class="form-group">
                                <label for="message">How Can We Help You?</label>
                                <textarea id="message" name="message" placeholder="Describe your needs" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Information Section -->
        <section class="features-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">GET IN TOUCH</div>
                    <h2 class="section-title">Contact Information</h2>
                    <p class="section-subtitle">We're here to help with all your needs</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fa-solid fa-phone"></i></div>
                        <h3 class="feature-title">Phone</h3>
                        <p class="feature-description"><?php echo esc_html($phone); ?></p>
                        <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-teal">Call Now</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fa-solid fa-envelope"></i></div>
                        <h3 class="feature-title">Email</h3>
                        <p class="feature-description"><?php echo esc_html($email); ?></p>
                        <a href="mailto:<?php echo esc_attr($email); ?>" class="btn btn-teal">Email Us</a>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fa-solid fa-location-dot"></i></div>
                        <h3 class="feature-title">Address</h3>
                        <p class="feature-description"><?php echo esc_html($address); ?></p>
                        <a href="#map" class="btn btn-teal">View Map</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section class="services-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">OUR SERVICES</div>
                    <h2 class="section-title">What We Offer</h2>
                </div>
                <div class="services-grid">
                    <?php
                    $services = ${JSON.stringify(services)};
                    foreach ($services as $service):
                        if (!empty($service['name'])):
                    ?>
                    <div class="service-card">
                        <div class="service-icon">✓</div>
                        <h3><?php echo esc_html($service['name']); ?></h3>
                        <p><?php echo esc_html($service['description']); ?></p>
                        <div class="service-phone"><?php echo esc_html($phone); ?></div>
                        <a href="#services" class="service-link">See More →</a>
                    </div>
                    <?php 
                        endif;
                    endforeach; 
                    ?>
                </div>
            </div>
        </section>
    </main>

    <?php include get_template_directory() . '/footer.php'; ?>
</body>
</html>`;

    // Location Template
    const locationPhp = `<?php
/*
 * Template Name: BSG Location
 * Description: Location page for your business
 */

// Get settings from admin panel
$settings = get_option('bsg_settings', []);

$business_name = '${businessName}';
$phone = '${phone}';
$email = '${email}';
$address = '${data.address || '123 Main Street, City, State 12345'}';

// Design colors
$primary_color = '${primaryColor}';
$secondary_color = '${secondaryColor}';
$accent_color = '${accentColor}';

// Service areas
$service_areas = array(
    ${locations.map((location: any) => `array('name' => '${location.name}', 'state' => '${location.state}')`).join(',\n    ')}
);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo esc_html($business_name . ' - Service Areas'); ?></title>
    <meta name="description" content="<?php echo esc_attr($business_name . ' serves multiple areas with professional services. Find out if we serve your location.'); ?>">
    <link rel="stylesheet" href="<?php echo get_stylesheet_uri(); ?>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: <?php echo esc_attr($primary_color); ?>;
            --secondary-color: <?php echo esc_attr($secondary_color); ?>;
            --accent-color: <?php echo esc_attr($accent_color); ?>;
            --surface-color: #0f172a;
            --text-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <?php include get_template_directory() . '/header.php'; ?>

    <main>
        <!-- Location Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <p class="subtitle">SERVICE AREAS</p>
                        <h1>Proudly Serving Multiple Locations</h1>
                        <p>Professional services available in your area</p>
                        <div class="hero-actions">
                            <a href="#contact" class="btn btn-teal">Get Free Quote</a>
                            <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-dark">Call <?php echo esc_html($phone); ?></a>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3 class="form-title">Get Your Free Quote</h3>
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" placeholder="Your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="Your email address" required>
                            </div>
                            <div class="form-group">
                                <label for="message">How Can We Help You?</label>
                                <textarea id="message" name="message" placeholder="Describe your needs" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Areas Section -->
        <section class="features-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">SERVICE AREAS</div>
                    <h2 class="section-title">Areas We Serve</h2>
                    <p class="section-subtitle">Professional services available in these locations</p>
                </div>
                <div class="features-grid">
                    <?php foreach ($service_areas as $area): ?>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fa-solid fa-location-dot"></i></div>
                        <h3 class="feature-title"><?php echo esc_html($area['name']); ?></h3>
                        <p class="feature-description">Professional services available in <?php echo esc_html($area['name']); ?>, <?php echo esc_html($area['state']); ?></p>
                        <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-teal">Call for Service</a>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section class="services-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">OUR SERVICES</div>
                    <h2 class="section-title">What We Offer</h2>
                </div>
                <div class="services-grid">
                    <?php
                    $services = ${JSON.stringify(services)};
                    foreach ($services as $service):
                        if (!empty($service['name'])):
                    ?>
                    <div class="service-card">
                        <div class="service-icon">✓</div>
                        <h3><?php echo esc_html($service['name']); ?></h3>
                        <p><?php echo esc_html($service['description']); ?></p>
                        <div class="service-phone"><?php echo esc_html($phone); ?></div>
                        <a href="#services" class="service-link">See More →</a>
                    </div>
                    <?php 
                        endif;
                    endforeach; 
                    ?>
                </div>
            </div>
        </section>
    </main>

    <?php include get_template_directory() . '/footer.php'; ?>
</body>
</html>`;

    // Add theme files to ZIP
    zip.file('style.css', styleCss);
    zip.file('index.php', indexPhp);
    zip.file('header.php', headerPhp);
    zip.file('footer.php', footerPhp);
    zip.file('functions.php', functionsPhp);
    // Service Archive Template
    const serviceArchivePhp = `<?php
/*
 * Template Name: BSG Service Archive
 * Description: Service archive page
 */

// Get settings from admin panel
$settings = get_option('bsg_settings', []);

$business_name = '${businessName}';
$phone = '${phone}';
$email = '${email}';
$address = '${data.address || '123 Main Street, City, State 12345'}';

// Design colors
$primary_color = '${primaryColor}';
$secondary_color = '${secondaryColor}';
$accent_color = '${accentColor}';

// Get all services
$services = array(
    ${services.map((service: any) => `array('name' => '${service.name}', 'description' => '${service.description}')`).join(',\n    ')}
);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo esc_html($business_name . ' - Our Services'); ?></title>
    <meta name="description" content="<?php echo esc_attr($business_name . ' provides professional services. View all our services and get free estimates.'); ?>">
    <link rel="stylesheet" href="<?php echo get_stylesheet_uri(); ?>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: <?php echo esc_attr($primary_color); ?>;
            --secondary-color: <?php echo esc_attr($secondary_color); ?>;
            --accent-color: <?php echo esc_attr($accent_color); ?>;
            --surface-color: #0f172a;
            --text-color: #e5e7eb;
        }
    </style>
</head>
<body>

    <?php include get_template_directory() . '/header.php'; ?>

    <main>
        <!-- Services Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <p class="subtitle">OUR SERVICES</p>
                        <h1>Professional Services You Can Trust</h1>
                        <p>Comprehensive solutions for all your needs</p>
                        <div class="hero-actions">
                            <a href="#contact" class="btn btn-teal">Get Free Quote</a>
                            <a href="tel:<?php echo esc_attr($phone); ?>" class="btn btn-dark">Call <?php echo esc_html($phone); ?></a>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3 class="form-title">Get Your Free Quote</h3>
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" placeholder="Your full name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="Your email address" required>
                            </div>
                            <div class="form-group">
                                <label for="message">How Can We Help You?</label>
                                <textarea id="message" name="message" placeholder="Describe your needs" required></textarea>
                            </div>
                            <button type="submit" class="btn-submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- All Services Section -->
        <section class="services-section section">
            <div class="container">
                <div class="section-header">
                    <div class="section-label">WHAT WE OFFER</div>
                    <h2 class="section-title">All Our Services</h2>
                    <p class="section-subtitle">Professional solutions tailored to your needs</p>
                </div>
                <div class="services-grid">
                    <?php foreach ($services as $service): ?>
                        <?php if (!empty($service['name'])): ?>
                        <div class="service-card">
                            <div class="service-icon">✓</div>
                            <h3><?php echo esc_html($service['name']); ?></h3>
                            <p><?php echo esc_html($service['description']); ?></p>
                            <div class="service-phone"><?php echo esc_html($phone); ?></div>
                            <a href="<?php echo home_url('/services/'); ?>" class="service-link">Learn More →</a>
                        </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </div>
            </div>
        </section>
    </main>

    <?php include get_template_directory() . '/footer.php'; ?>
</body>
</html>`;

    zip.file('page-service.php', servicePhp);
    zip.file('page-services.php', serviceArchivePhp);
    zip.file('page-about.php', aboutPhp);
    zip.file('page-contact.php', contactPhp);
    zip.file('page-location.php', locationPhp);
    
    const content = await zip.generateAsync({ type: 'uint8array' });
    const b64 = Buffer.from(content).toString('base64');
    return NextResponse.json({ 
      themeName: `${businessName}-Theme`, 
      themeZip: b64 
    });
  } catch (e: any) {
    return NextResponse.json({ error: e?.message || 'Failed to build theme' }, { status: 500 });
  }
}
